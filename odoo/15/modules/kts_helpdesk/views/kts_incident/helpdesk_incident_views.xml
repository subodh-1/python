<?xml version='1.0' encoding='utf-8' ?>
<odoo>
    <record id="helpdesk_ticket_view_search" model="ir.ui.view">
        <field name="name">helpdesk.incident.view.search</field>
        <field name="model">helpdesk.incident</field>
        <field name="arch" type="xml">
            <search>
                <field name="number" />
                <field name="name" />
                <field name="category_id" />
                <field name="responsible_user"/>
                <field name="current_status"/>
                <field name="close_by"/>
                <field name="create_uid"/>
                <group expand="0" string="Group By">
                    <filter string="Status" name="current_status" domain="[]" context="{'group_by': 'current_status'}"/>
                </group>
            </search>
        </field>
    </record>
    <record id="ticket_view_form" model="ir.ui.view">
        <field name="name">helpdesk.incident.view.form</field>
        <field name="model">helpdesk.incident</field>
        <field name="arch" type="xml">
            <form string="Incident">
                <header name="incident_header">
                    <field
                            name="workflow_stage_id"
                            widget="statusbar"
                            context="{'workflow_id':workflow_id,'confirmOnSave':True}"
                            type="object"
                            options="{'clickable': '1', 'fold_field': 'fold'}"
                            attrs="{'invisible':[('workflow_id', '==', False)]}"
                    />
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1 class="oe_title">
                            <field name="number" />
                        </h1>
                        <label string="Title Name" for="name"/><br/>
                        <h2 class="o_row">
                            <field name="name" required="1"/>
                        </h2>
                    </div>
                    <group>
                        <group>
                            <field name="priority" widget="priority" />
                            <field name="category_id" required="1" options='{"no_open": True, "no_create": True}'/>
                            <field name="channel_id" options='{"no_open": True, "no_create": True}'/>
                        </group>
                        <group>

                            <field name="it_remark" groups="kts_workflow.group_defence_admin" force_save="1"
                                   options='{"no_open": True, "no_create": True}'/>

                            <field name="it_remark" groups="kts_workflow.group_defence_user" readonly="1" force_save="1"
                                   options='{"no_open": True, "no_create": True}'/>

                            <field name="create_date" readonly="1" class="oe_read_only"/>
                        </group>
                    </group>
                    <group name="main">
                        <field name="ticket_attachment_ids" widget="many2many_binary"/>
                        <field name="workflow_id" invisible="1" options='{"no_open": True, "no_create": True}'
                               context="{'default_workflow_id':workflow_id}"/>
                        <field name="stage_sequence" invisible="1"/>
                    </group>
                    <field name="workflow_lines" widget="one2many" context="{'workflow_id':workflow_id}"/>
                    <group>
                        <notebook>
                            <page string="Description" name="description">
                                <field name="description" required="1"/>
                            </page>
                        </notebook>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field
                        name="message_ids"
                        widget="mail_thread"
                        options="{'post_refresh': 'recipients', 'open_attachments': True}"
                    />
                </div>
            </form>
        </field>
    </record>
    <record id="ticket_view_tree" model="ir.ui.view">
        <field name="name">helpdesk.incident.view.tree</field>
        <field name="model">helpdesk.incident</field>
        <field name="arch" type="xml">
            <tree decoration-danger="priority=='4'" decoration-warning="priority=='3'" decoration-info="priority=='2'">
                <field name="number" optional="show"/>
                <field name="name" optional="show"/>
                <field name="description" optional="show"/>
                <field name="category_id" optional="show"/>
                <field name="create_date" optional="show"/>
                <field name="responsible_user" optional="show"/>
                <field name="current_status"  widget="badge" decoration-success="stage_sequence == 1"
                       decoration-info="stage_sequence == 2" decoration-primary="stage_sequence == 3"
                       decoration-warning="stage_sequence==4" decoration-danger="stage_sequence==5"
                       decoration-muted="stage_sequence == 6" optional="show"/>
                <field name="close_date" optional="show"/>
                <field name="close_by" optional="hide"/>
                <field name="create_uid" string="Reported by" optional="hide"/>
                <field name="priority" widget="priority" optional="hide"/>
                <field name="channel_id" optional="hide"/>
                <field name="it_remark" optional="hide"/>
                <field name="stage_sequence" optional="hide"/>
            </tree>
        </field>
    </record>
    <record id="helpdesk_ticket_views_pivot" model="ir.ui.view">
        <field name="name">helpdesk.incident.view.pivot</field>
        <field name="model">helpdesk.incident</field>
        <field name="arch" type="xml">
            <pivot string="Pivot Analysis" disable_linking="True">
                <field name="category_id" type="row" />
                <field name="create_date" type="col" />
            </pivot>
        </field>
    </record>
</odoo>
